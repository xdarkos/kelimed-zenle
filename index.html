<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Tabu Kelime Eleme</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --bg1:#ff6b6b;
      --bg2:#4ecdc4;

      --ink:#0f172a;
      --muted:#64748b;

      --glass: rgba(255,255,255,.82);
      --glass2: rgba(255,255,255,.70);
      --stroke: rgba(255,255,255,.30);

      --shadow: 0 22px 70px rgba(0,0,0,.18);
      --shadow2: 0 12px 30px rgba(0,0,0,.12);

      --radius: 22px;
      --radius2: 16px;

      --ok1:#2ecc71; --ok2:#27ae60;
      --bad1:#e74c3c; --bad2:#c0392b;
      --info1:#3498db; --info2:#2980b9;
      --warn1:#f39c12; --warn2:#e67e22;
      --copy1:#8e44ad; --copy2:#6c5ce7;

      --focus: rgba(255,107,107,.22);
    }

    *{
      margin:0; padding:0; box-sizing:border-box;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      -webkit-tap-highlight-color:transparent;
    }

    body{
      min-height:100vh;
      color:var(--ink);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:
        radial-gradient(1200px 800px at 10% 10%, rgba(255,255,255,.24), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(255,255,255,.18), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
      touch-action:manipulation;
    }

    .bg-blob{
      position:fixed;
      width:420px; height:420px;
      filter: blur(40px);
      opacity:.40;
      border-radius:999px;
      pointer-events:none;
      z-index:0;
      animation: floaty 10s ease-in-out infinite;
    }
    .blob1{ left:-160px; top:-130px; background: rgba(255,255,255,.55); }
    .blob2{ right:-160px; top:140px; background: rgba(255,255,255,.40); animation-delay:2s; }
    .blob3{ left:120px; bottom:-190px; background: rgba(255,255,255,.32); animation-delay:4s; }

    @keyframes floaty{
      0%,100%{ transform: translate3d(0,0,0) scale(1); }
      50%{ transform: translate3d(0,-18px,0) scale(1.03); }
    }

    .app-shell{
      width:100%;
      max-width: 1020px;
      position:relative;
      z-index:1;
    }

    .container{
      width:100%;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background: var(--glass);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid var(--stroke);
      overflow:hidden;
    }

    .header{
      padding: 22px 22px 14px;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }

    .brand{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
    }
    .brand .logo{
      width:38px; height:38px;
      border-radius:12px;
      background: linear-gradient(135deg, rgba(255,107,107,.95), rgba(78,205,196,.95));
      display:grid;
      place-items:center;
      color:white;
      box-shadow: 0 10px 22px rgba(0,0,0,.14);
    }
    .brand h1{
      font-size: 1.9rem;
      letter-spacing:.2px;
      background: linear-gradient(to right, #ff6b6b, #4ecdc4);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .subtitle{
      margin-top:10px;
      text-align:center;
      color: var(--muted);
      line-height:1.55;
      font-size:1.02rem;
      padding: 0 12px;
    }

    .content{ padding: 18px 22px 22px; }

    .phase{ display:none; animation: fadeIn .26s ease; }
    .phase.active{ display:block; }

    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(8px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .section-title{
      text-align:center;
      margin: 10px 0 18px;
      font-size: 1.35rem;
      color:#111827;
      letter-spacing:.2px;
    }

    /* MODE CARDS */
    .mode-selector{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:16px;
      margin-top: 6px;
    }
    .mode-btn{
      padding: 18px 16px;
      border:none;
      border-radius: 18px;
      cursor:pointer;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      text-align:left;
      background: rgba(255,255,255,.70);
      border: 2px solid rgba(0,0,0,.06);
      box-shadow: var(--shadow2);
      user-select:none;
      position:relative;
      overflow:hidden;
    }
    .mode-btn::before{
      content:'';
      position:absolute;
      inset:-40px -40px auto auto;
      width:120px; height:120px;
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,107,107,.28), transparent 60%);
      transform: rotate(20deg);
      pointer-events:none;
    }
    .mode-btn:hover{ transform: translateY(-3px); box-shadow: 0 16px 38px rgba(0,0,0,.14); }
    .mode-btn:active{ transform: translateY(-1px); }
    .mode-btn.active{ border-color: rgba(255,107,107,.55); }

    .mode-btn .row{ display:flex; align-items:center; gap:12px; width:100%; }
    .mode-btn .icon{
      width:44px; height:44px;
      border-radius: 14px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(255,107,107,.95), rgba(78,205,196,.95));
      color:white;
      box-shadow: 0 10px 20px rgba(0,0,0,.12);
      flex: 0 0 auto;
    }
    .mode-btn h3{ font-size: 1.15rem; color:#111827; margin:0; }
    .mode-btn p{ margin-top:10px; color: var(--muted); line-height:1.45; font-size: .98rem; }

    /* INPUT */
    .instructions{
      background: rgba(255,255,255,.74);
      border-radius: 16px;
      padding: 14px;
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 10px 26px rgba(0,0,0,.08);
      margin-bottom: 14px;
    }
    .instructions h3{
      display:flex; align-items:center; gap:8px;
      color:#ff6b6b;
      font-size:1.05rem;
      margin-bottom:6px;
    }
    .instructions p{
      color:#374151;
      font-size:.96rem;
      line-height:1.55;
    }

    .textarea-wrap{
      position:relative;
      border-radius: 18px;
      overflow:hidden;
      box-shadow: 0 12px 30px rgba(0,0,0,.10);
      border: 2px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.60);
    }
    .textarea-wrap:focus-within{
      border-color: rgba(255,107,107,.65);
      box-shadow: 0 0 0 4px var(--focus), 0 16px 40px rgba(0,0,0,.12);
    }
    textarea{
      width:100%;
      height: 240px;
      padding: 18px 16px;
      font-size: 1.05rem;
      border: none;
      outline: none;
      resize: vertical;
      line-height: 1.55;
      background: transparent;
      color:#0b1220;
    }

    /* Saydam iç yazı (placeholder gibi) */
    .pseudo-placeholder{
      position:absolute;
      inset:0;
      padding: 18px 16px;
      color: rgba(15,23,42,.50);
      font-size: 1.05rem;
      line-height: 1.55;
      pointer-events:none;
      user-select:none;
      white-space:pre-wrap;
      transition: opacity .16s ease;
    }
    .pseudo-placeholder.hidden{ opacity:0; }

    /* PROGRESS + WORD */
    .progress-container{ margin: 18px 0 10px; }
    .progress-text{
      display:flex; justify-content:space-between;
      margin-bottom:8px;
      font-weight:800;
      color:#111827;
      font-size:.95rem;
    }
    .progress-bar{
      height: 12px;
      background: rgba(17,24,39,.08);
      border-radius: 999px;
      overflow:hidden;
    }
    .progress-fill{
      height:100%;
      width:0%;
      border-radius: 999px;
      background: linear-gradient(to right, #ff6b6b, #4ecdc4);
      transition: width .35s ease;
    }

    .word-display{ text-align:center; margin: 18px 0 12px; }
    .word-display h3{
      color:#111827;
      font-size: 1.05rem;
      font-weight:900;
      letter-spacing:.2px;
      opacity:.92;
      margin-bottom:10px;
    }
    .current-word{
      font-size: 2.35rem;
      font-weight: 950;
      letter-spacing: .2px;
      color: #0f172a;
      padding: 26px 16px;
      border-radius: 18px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: 0 14px 34px rgba(0,0,0,.10);
      min-height: 140px;
      display:flex;
      align-items:center;
      justify-content:center;
      word-break:break-word;
      overflow-wrap:break-word;
      line-height:1.25;
    }
    .counter{
      margin-top:12px;
      color: var(--muted);
      font-weight:800;
      font-size: 1rem;
    }

    .word-animation{ animation: wordAppear .24s ease-out; }
    @keyframes wordAppear{
      0%{ opacity:0; transform:scale(0.965); }
      100%{ opacity:1; transform:scale(1); }
    }

    .action-buttons{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 14px;
    }
    .big-action-btn{
      height: 114px;
      border: none;
      border-radius: 20px;
      cursor:pointer;
      color:white;
      font-size: 1.15rem;
      font-weight: 950;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:8px;
      box-shadow: 0 14px 34px rgba(0,0,0,.14);
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
      user-select:none;
    }
    .big-action-btn:active{ transform: scale(.985); }
    .big-action-btn i{ font-size: 2.15rem; }
    .big-correct{ background: linear-gradient(135deg, var(--ok1), var(--ok2)); }
    .big-incorrect{ background: linear-gradient(135deg, var(--bad1), var(--bad2)); }

    /* BUTTONS */
    .buttons{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 16px;
      justify-content:center;
    }
    .btn{
      border: none;
      border-radius: 999px;
      cursor:pointer;
      padding: 14px 18px;
      font-size: 1.02rem;
      font-weight: 900;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      min-width: 170px;
      flex: 1;
      max-width: 330px;
      box-shadow: 0 12px 28px rgba(0,0,0,.12);
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-2px); box-shadow: 0 16px 36px rgba(0,0,0,.14); }
    .btn:active{ transform: translateY(0); filter: brightness(.98); }

    .btn-primary{ background: linear-gradient(to right, #ff6b6b, #4ecdc4); color:#fff; }
    .btn-success{ background: linear-gradient(to right, var(--ok1), var(--ok2)); color:#fff; }
    .btn-danger{ background: linear-gradient(to right, var(--bad1), var(--bad2)); color:#fff; }
    .btn-neutral{ background: linear-gradient(to right, #94a3b8, #64748b); color:#fff; }
    .btn-warning{ background: linear-gradient(to right, var(--warn1), var(--warn2)); color:#fff; }
    .btn-download{ background: linear-gradient(to right, var(--info1), var(--info2)); color:#fff; }
    .btn-copy{ background: linear-gradient(to right, var(--copy1), var(--copy2)); color:#fff; }

    /* RESULTS */
    .results-container{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-top: 18px;
    }
    #phase4 .results-container{ grid-template-columns: 1fr; }

    .results-box{
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(0,0,0,.07);
      border-top: 5px solid;
      border-radius: 18px;
      padding: 16px;
      box-shadow: 0 14px 34px rgba(0,0,0,.10);
      min-height: 250px;
    }
    .correct-results{ border-top-color: var(--ok1); }
    .incorrect-results{ border-top-color: var(--bad1); }
    .unique-results{ border-top-color: var(--info1); }

    .results-title{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-size: 1.1rem;
      font-weight: 950;
      margin-bottom: 12px;
      color:#111827;
    }
    .results-title span{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 36px;
      height: 28px;
      padding: 0 10px;
      border-radius: 999px;
      background: rgba(17,24,39,.06);
      font-size: .95rem;
      font-weight: 950;
      color:#111827;
    }

    .results-list{
      list-style:none;
      max-height: 280px;
      overflow:auto;
      padding-right: 6px;
    }
    .results-list::-webkit-scrollbar{ width:8px; }
    .results-list::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.18); border-radius: 999px; }
    .results-list::-webkit-scrollbar-track{ background: rgba(0,0,0,.05); border-radius: 999px; }

    .results-list li{
      background: rgba(255,255,255,.88);
      border: 1px solid rgba(0,0,0,.06);
      border-left: 4px solid;
      border-radius: 14px;
      padding: 10px 12px;
      margin-bottom: 10px;
      font-weight: 800;
      color:#111827;
      word-break: break-word;
    }
    .correct-results .results-list li{ border-left-color: var(--ok1); }
    .incorrect-results .results-list li{ border-left-color: var(--bad1); }
    .unique-results .results-list li{ border-left-color: var(--info1); }

    .stats-container{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin: 16px 0 6px;
    }
    .stat-box{
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(0,0,0,.07);
      border-radius: 18px;
      padding: 14px;
      text-align:center;
      box-shadow: 0 14px 34px rgba(0,0,0,.10);
    }
    .stat-value{ font-size: 1.95rem; font-weight: 1000; color:#111827; }
    .stat-label{ margin-top:6px; color:var(--muted); font-weight:900; font-size:.92rem; }

    .info-card{
      margin-top: 16px;
      padding: 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(0,0,0,.07);
      box-shadow: 0 14px 34px rgba(0,0,0,.10);
      text-align:center;
    }
    .info-card h4{
      display:flex; align-items:center; justify-content:center; gap:10px;
      font-size: 1.05rem;
      font-weight: 1000;
      color:#111827;
      margin-bottom: 8px;
    }
    .info-card p{ color:#374151; line-height:1.5; font-weight:800; font-size:.95rem; }

    .copy-buttons, .download-buttons{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }

    .result-message{
      text-align:center;
      padding: 14px 16px;
      border-radius: 16px;
      color:white;
      font-weight: 1000;
      margin: 16px auto 6px;
      max-width: 520px;
      box-shadow: 0 16px 40px rgba(0,0,0,.14);
    }

    .footer{
      margin-top: 14px;
      text-align:center;
      color: rgba(255,255,255,.88);
      font-weight: 800;
      font-size: .88rem;
      padding: 10px;
      user-select:none;
    }

    /* RESPONSIVE */
    @media (max-width: 820px){
      .mode-selector{ grid-template-columns: 1fr; }
      .results-container{ grid-template-columns: 1fr; }
      .copy-buttons, .download-buttons{ grid-template-columns: 1fr; }
    }
    @media (max-width: 480px){
      body{ padding: 12px; align-items:flex-start; }
      .header{ padding: 18px 16px 12px; }
      .content{ padding: 14px 16px 16px; }
      .brand h1{ font-size: 1.55rem; }
      .subtitle{ font-size: .98rem; }
      textarea{ height: 210px; font-size: 1.02rem; }
      .current-word{ font-size: 1.95rem; min-height: 122px; }
      .big-action-btn{ height: 106px; font-size: 1.05rem; }
    }

    /* DARK MODE */
    @media (prefers-color-scheme: dark){
      body{
        background:
          radial-gradient(1200px 800px at 10% 10%, rgba(0,0,0,.25), transparent 60%),
          radial-gradient(900px 600px at 90% 20%, rgba(0,0,0,.20), transparent 60%),
          linear-gradient(135deg, #0b1220, #0f3b36);
      }
      .container{
        background: rgba(15,23,42,.72);
        border-color: rgba(255,255,255,.12);
      }
      .subtitle{ color: rgba(226,232,240,.78); }
      .section-title{ color: rgba(241,245,249,.92); }
      .mode-btn, .instructions, .textarea-wrap, .current-word, .results-box, .stat-box, .info-card{
        background: rgba(2,6,23,.40);
        border-color: rgba(255,255,255,.10);
      }
      .mode-btn h3{ color: rgba(241,245,249,.92); }
      .mode-btn p, .instructions p, .stat-label, .info-card p{ color: rgba(226,232,240,.74); }
      textarea{ color: rgba(241,245,249,.92); }
      .pseudo-placeholder{ color: rgba(241,245,249,.42); }
      .results-title{ color: rgba(241,245,249,.92); }
      .results-title span{ background: rgba(255,255,255,.08); color: rgba(241,245,249,.92); }
      .results-list li{ background: rgba(2,6,23,.30); border-color: rgba(255,255,255,.10); color: rgba(241,245,249,.92); }
      .progress-text{ color: rgba(241,245,249,.92); }
      .progress-bar{ background: rgba(255,255,255,.10); }
    }

    /* Toast */
    .toast{
      position: fixed;
      top: 18px;
      right: 18px;
      z-index: 9999;
      max-width: 360px;
      padding: 14px 16px;
      border-radius: 14px;
      color: white;
      font-weight: 900;
      box-shadow: 0 16px 40px rgba(0,0,0,.22);
      display:flex;
      gap:10px;
      align-items:flex-start;
      animation: toastIn .22s ease-out;
      user-select:none;
    }
    @keyframes toastIn{ from{ opacity:0; transform: translateX(20px); } to{ opacity:1; transform: translateX(0); } }
    @keyframes toastOut{ from{ opacity:1; transform: translateX(0); } to{ opacity:0; transform: translateX(20px); } }
  </style>
</head>

<body>
  <div class="bg-blob blob1"></div>
  <div class="bg-blob blob2"></div>
  <div class="bg-blob blob3"></div>

  <div class="app-shell">
    <div class="container">
      <div class="header">
        <div class="brand">
          <div class="logo"><i class="fas fa-filter"></i></div>
          <h1>Tabu Kelime Eleme</h1>
        </div>
        <p class="subtitle">
          Kelimelerinizi sırasıyla eleyin veya büyük/küçük harf fark etmeksizin <b>tam eşleşen</b> tekrarları temizleyip benzersiz liste oluşturun.
          (Örn: “seher” ile “seher yıldız” <u>aynı sayılmaz</u>.)
        </p>
      </div>

      <div class="content">
        <!-- PHASE 0 -->
        <div id="phase0" class="phase active">
          <h2 class="section-title">Mod Seçin</h2>

          <div class="mode-selector">
            <div id="mode1Btn" class="mode-btn active" role="button" tabindex="0" aria-label="Kelime Eleme Modu">
              <div class="row">
                <div class="icon"><i class="fas fa-check-circle"></i></div>
                <h3>Kelime Eleme</h3>
              </div>
              <p>Kelimeleri <b>girdiğiniz sırayla</b> tek tek görüp “Biliyorum / Tekrar Çalış” olarak ayırın.</p>
            </div>

            <div id="mode2Btn" class="mode-btn" role="button" tabindex="0" aria-label="Aynıları Bul Modu">
              <div class="row">
                <div class="icon"><i class="fas fa-search"></i></div>
                <h3>Aynıları Bul</h3>
              </div>
              <p>
                <b>Tam eşleşme</b> ile tekrar edenleri tespit eder.
                Büyük/küçük harf ve Türkçe “i/İ” farklarını yok sayar.
              </p>
            </div>
          </div>

          <div class="buttons" style="margin-top:18px;">
            <button id="continueBtn" class="btn btn-primary">
              <i class="fas fa-arrow-right"></i> Seçilen Mod ile Devam Et
            </button>
          </div>
        </div>

        <!-- PHASE 1 -->
        <div id="phase1" class="phase">
          <div class="instructions">
            <h3><i class="fas fa-info-circle"></i> Nasıl Yazabilirsiniz?</h3>
            <p>
              Virgül (,) veya yeni satır ile ayırın. İsterseniz numaralı da yazabilirsiniz:
              <b>1. Donald Duck</b> gibi. Sistem “1.” kısmını otomatik kaldırır.
            </p>
          </div>

          <div class="textarea-wrap">
            <textarea id="wordInput" aria-label="Kelimeler"></textarea>
            <div id="pseudoPlaceholder" class="pseudo-placeholder">
Örnek:
1. Donald Duck
2. Robin Hood
3. Bugs Bunny
4. Tom ve Jerry
5. Tweety
6. Alaaddin'in Lambası

Veya:
PANSİYON, GÖZLÜK, KARANLIK ODA, GÖZYAŞI
            </div>
          </div>

          <div class="buttons">
            <button id="startBtn" class="btn btn-primary">
              <i class="fas fa-play"></i> Başla
            </button>
            <button id="backToModeBtn" class="btn btn-neutral">
              <i class="fas fa-arrow-left"></i> Mod Seçimine Dön
            </button>
          </div>
        </div>

        <!-- PHASE 2 (ELEME) -->
        <div id="phase2" class="phase">
          <div class="progress-container">
            <div class="progress-text">
              <span>İlerleme</span>
              <span id="progressText">0/0</span>
            </div>
            <div class="progress-bar">
              <div id="progressFill" class="progress-fill"></div>
            </div>
          </div>

          <div class="word-display">
            <h3>Bu Tabu kelimesini biliyor musunuz?</h3>
            <div id="currentWord" class="current-word">KELİME</div>
            <div id="counter" class="counter">Kalan: 0</div>
          </div>

          <div class="action-buttons">
            <button id="bigCorrectBtn" class="big-action-btn big-correct">
              <i class="fas fa-check-circle"></i>
              <span>BİLİYORUM</span>
            </button>
            <button id="bigIncorrectBtn" class="big-action-btn big-incorrect">
              <i class="fas fa-times-circle"></i>
              <span>TEKRAR ÇALIŞ</span>
            </button>
          </div>

          <div class="buttons">
            <button id="pauseBtn" class="btn btn-neutral">
              <i class="fas fa-stop"></i> Durdur
            </button>
          </div>
        </div>

        <!-- PHASE 3 (ELEME RESULTS) -->
        <div id="phase3" class="phase">
          <h2 class="section-title" style="margin-bottom:10px;">Tabu Eleme Sonuçları</h2>
          <p style="text-align:center; margin-bottom:14px; color: var(--muted); font-weight:900;">
            Toplam <span id="totalWordsCount" style="color: var(--ink);">0</span> kelime üzerinden eleme tamamlandı.
          </p>

          <div class="progress-container" style="margin: 0 auto 10px; max-width: 360px;">
            <div class="progress-text">
              <span>Bilinen Oranı</span>
              <span id="correctPercentage">0%</span>
            </div>
            <div class="progress-bar">
              <div id="correctPercentageBar" class="progress-fill" style="background: linear-gradient(to right, var(--ok1), var(--ok2));"></div>
            </div>
          </div>

          <div class="info-card">
            <h4><i class="fas fa-copy"></i> Kopyalama</h4>
            <p>“Virgüllü” butonlar doğrudan panoya kopyalar. İsterseniz ayrıca “İndir” butonlarıyla .txt alabilirsiniz.</p>

            <div class="copy-buttons">
              <button id="copyKnownCommaBtn" class="btn btn-copy">
                <i class="fas fa-clipboard"></i> Bildiklerimi Virgüllü Kopyala
              </button>
              <button id="copyWrongCommaBtn" class="btn btn-copy">
                <i class="fas fa-clipboard"></i> Tekrar Çalış Virgüllü Kopyala
              </button>
            </div>

            <div class="copy-buttons" style="margin-top:12px;">
              <button id="copyKnownNumberedBtn" class="btn btn-copy">
                <i class="fas fa-list-ol"></i> Bildiklerimi Numaralı Kopyala
              </button>
              <button id="copyWrongNumberedBtn" class="btn btn-copy">
                <i class="fas fa-list-ol"></i> Tekrar Çalış Numaralı Kopyala
              </button>
            </div>

            <div class="download-buttons">
              <button id="downloadAllBtn" class="btn btn-download">
                <i class="fas fa-file-download"></i> Tüm Sonuçları İndir
              </button>
              <button id="downloadWrongBtn" class="btn btn-danger">
                <i class="fas fa-file-excel"></i> Tekrar Çalışılacakları İndir
              </button>
            </div>
          </div>

          <div class="results-container">
            <div class="results-box correct-results">
              <div class="results-title">
                <div><i class="fas fa-check-circle" style="color: var(--ok2);"></i> Bildikleriniz</div>
                <span id="correctCount">0</span>
              </div>
              <ul id="correctList" class="results-list"></ul>
            </div>

            <div class="results-box incorrect-results">
              <div class="results-title">
                <div><i class="fas fa-times-circle" style="color: var(--bad2);"></i> Tekrar Çalışılacaklar</div>
                <span id="incorrectCount">0</span>
              </div>
              <ul id="incorrectList" class="results-list"></ul>
            </div>
          </div>

          <div class="buttons">
            <button id="restartBtn" class="btn btn-primary">
              <i class="fas fa-redo"></i> Aynı Listeyle Yeniden Başla
            </button>
            <button id="practiceWrongBtn" class="btn btn-danger">
              <i class="fas fa-book"></i> Sadece Tekrar Çalışılacakları Ele
            </button>
            <button id="newListBtn" class="btn btn-neutral">
              <i class="fas fa-list"></i> Yeni Liste
            </button>
            <button id="backToModeFromElemeBtn" class="btn btn-neutral">
              <i class="fas fa-arrow-left"></i> Mod Seçimine Dön
            </button>
          </div>
        </div>

        <!-- PHASE 4 (UNIQUE RESULTS) -->
        <div id="phase4" class="phase">
          <h2 class="section-title" style="margin-bottom:10px;">Benzersiz Kelime Sonuçları</h2>

          <div class="stats-container">
            <div class="stat-box">
              <div class="stat-value" id="originalCount">0</div>
              <div class="stat-label">Orijinal Sayı</div>
            </div>
            <div class="stat-box">
              <div class="stat-value" id="uniqueCount">0</div>
              <div class="stat-label">Benzersiz</div>
            </div>
            <div class="stat-box">
              <div class="stat-value" id="duplicateCount">0</div>
              <div class="stat-label">Çıkarılan Tekrar</div>
            </div>
          </div>

          <div class="info-card">
            <h4><i class="fas fa-copy"></i> Kopyalama / İndirme</h4>
            <p>
              Benzersiz liste <b>Title Case</b> üretilir: “eren ilhan” → “Eren İlhan”.
              Büyük/küçük ve Türkçe “i/İ” farkları aynı kabul edilir.
            </p>

            <div class="copy-buttons">
              <button id="copyUniqueCommaBtn" class="btn btn-copy">
                <i class="fas fa-clipboard"></i> Benzersiz Virgüllü Kopyala
              </button>
              <button id="copyDupCommaBtn" class="btn btn-copy">
                <i class="fas fa-clipboard"></i> Tekrar Edenleri Virgüllü Kopyala
              </button>
            </div>

            <div class="copy-buttons" style="margin-top:12px;">
              <button id="copyUniqueNumberedBtn" class="btn btn-copy">
                <i class="fas fa-list-ol"></i> Benzersiz Numaralı Kopyala
              </button>
              <button id="copyDupNumberedBtn" class="btn btn-copy">
                <i class="fas fa-list-ol"></i> Tekrar Edenleri Numaralı Kopyala
              </button>
            </div>

            <div class="download-buttons">
              <button id="downloadUniqueBtn" class="btn btn-download">
                <i class="fas fa-file-download"></i> Benzersiz Listeyi İndir
              </button>
              <button id="downloadDuplicatesBtn" class="btn btn-warning">
                <i class="fas fa-file-excel"></i> Tekrar Edenleri İndir
              </button>
            </div>
          </div>

          <div class="results-container">
            <div class="results-box unique-results">
              <div class="results-title">
                <div><i class="fas fa-search" style="color: var(--info2);"></i> Benzersiz Kelimeler</div>
                <span id="uniqueWordsCount">0</span>
              </div>
              <ul id="uniqueList" class="results-list"></ul>
            </div>
          </div>

          <div class="buttons">
            <button id="restartUniqueBtn" class="btn btn-primary">
              <i class="fas fa-redo"></i> Yeni Liste ile Başla
            </button>
            <button id="backToModeFromResultsBtn" class="btn btn-neutral">
              <i class="fas fa-arrow-left"></i> Mod Seçimine Dön
            </button>
          </div>
        </div>

      </div>
    </div>

    <div class="footer">
      Tabu Kelime Eleme Uygulaması | Kopyala / İndir
    </div>
  </div>

  <script>
    // =========================
    // STATE
    // =========================
    let allWords = [];
    let originalWords = [];
    let currentWordIndex = 0;

    let correctWords = [];
    let incorrectWords = [];

    let currentMode = 1; // 1: Eleme, 2: Aynıları Bul

    // Mod 2
    let uniqueWords = [];          // Title Case list
    let duplicateWordsCounted = []; // "Eren İlhan (6 kez)"
    let duplicateBaseWords = [];    // sadece "Eren İlhan"
    let wordCountMap = new Map();   // key -> count

    // =========================
    // DOM
    // =========================
    const phases = {
      0: document.getElementById('phase0'),
      1: document.getElementById('phase1'),
      2: document.getElementById('phase2'),
      3: document.getElementById('phase3'),
      4: document.getElementById('phase4'),
    };

    const mode1Btn = document.getElementById('mode1Btn');
    const mode2Btn = document.getElementById('mode2Btn');
    const continueBtn = document.getElementById('continueBtn');

    const backToModeBtn = document.getElementById('backToModeBtn');
    const backToModeFromElemeBtn = document.getElementById('backToModeFromElemeBtn');
    const backToModeFromResultsBtn = document.getElementById('backToModeFromResultsBtn');

    const wordInput = document.getElementById('wordInput');
    const pseudoPlaceholder = document.getElementById('pseudoPlaceholder');

    const startBtn = document.getElementById('startBtn');

    const currentWordElement = document.getElementById('currentWord');
    const bigCorrectBtn = document.getElementById('bigCorrectBtn');
    const bigIncorrectBtn = document.getElementById('bigIncorrectBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    const progressText = document.getElementById('progressText');
    const progressFill = document.getElementById('progressFill');
    const counter = document.getElementById('counter');

    const totalWordsCount = document.getElementById('totalWordsCount');
    const correctPercentage = document.getElementById('correctPercentage');
    const correctPercentageBar = document.getElementById('correctPercentageBar');

    const correctList = document.getElementById('correctList');
    const incorrectList = document.getElementById('incorrectList');
    const correctCount = document.getElementById('correctCount');
    const incorrectCount = document.getElementById('incorrectCount');

    const restartBtn = document.getElementById('restartBtn');
    const practiceWrongBtn = document.getElementById('practiceWrongBtn');
    const newListBtn = document.getElementById('newListBtn');

    const downloadAllBtn = document.getElementById('downloadAllBtn');
    const downloadWrongBtn = document.getElementById('downloadWrongBtn');
    const downloadUniqueBtn = document.getElementById('downloadUniqueBtn');
    const downloadDuplicatesBtn = document.getElementById('downloadDuplicatesBtn');

    const copyKnownCommaBtn = document.getElementById('copyKnownCommaBtn');
    const copyWrongCommaBtn = document.getElementById('copyWrongCommaBtn');
    const copyKnownNumberedBtn = document.getElementById('copyKnownNumberedBtn');
    const copyWrongNumberedBtn = document.getElementById('copyWrongNumberedBtn');

    const copyUniqueCommaBtn = document.getElementById('copyUniqueCommaBtn');
    const copyDupCommaBtn = document.getElementById('copyDupCommaBtn');
    const copyUniqueNumberedBtn = document.getElementById('copyUniqueNumberedBtn');
    const copyDupNumberedBtn = document.getElementById('copyDupNumberedBtn');

    const uniqueList = document.getElementById('uniqueList');
    const originalCount = document.getElementById('originalCount');
    const uniqueCount = document.getElementById('uniqueCount');
    const duplicateCount = document.getElementById('duplicateCount');
    const uniqueWordsCount = document.getElementById('uniqueWordsCount');

    const restartUniqueBtn = document.getElementById('restartUniqueBtn');

    // =========================
    // HELPERS
    // =========================
    function setActivePhase(n){
      Object.values(phases).forEach(p => p.classList.remove('active'));
      phases[n].classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function normalizeSpaces(s){
      return String(s ?? '')
        .replace(/\u00A0/g, ' ')
        .replace(/\s+/g, ' ')
        .trim();
    }

    // Satır başındaki "1. " / "1)" / "1-" / "1:" gibi numaraları kaldır
    function stripLeadingNumbering(s){
      let t = String(s ?? '');
      // ör: "1. Donald", "12) Robin", "3 - Bugs", "4: Tom", "5)   Tweety"
      t = t.replace(/^\s*\d+\s*([.)\]\-:])\s*/u, '');
      // bazen "1 Donald" (noktasız) yazılırsa:
      t = t.replace(/^\s*\d+\s+(?=\S)/u, '');
      return t;
    }

    function cleanDisplayWord(raw){
      const s = normalizeSpaces(stripLeadingNumbering(raw));
      return s;
    }

    // Anahtar: tam eşleşme, TR locale lower, boşluk normalize
    function normalizeKey(raw){
      const d = cleanDisplayWord(raw);
      return d.toLocaleLowerCase('tr-TR');
    }

    // Title Case (TR): her kelimenin ilk harfi büyük, kalanı küçük
    // "eren ilhan nere" -> "Eren İlhan Nere"
    function toTitleCaseTR(raw){
      const s = normalizeSpaces(raw).toLocaleLowerCase('tr-TR');
      if (!s) return '';

      const parts = s.split(' ');
      const titled = parts.map(w => {
        if (!w) return w;
        const first = w.charAt(0).toLocaleUpperCase('tr-TR');
        const rest = w.slice(1);
        return first + rest;
      });
      return titled.join(' ');
    }

    // Input: virgül veya yeni satır ayırıcı; her parçada numbering temizlenir.
    function parseInputWords(text){
      const raw = String(text ?? '').trim();
      if (!raw) return [];

      return raw
        .split(/[,\n]/)
        .map(x => cleanDisplayWord(x))
        .filter(x => x !== '');
    }

    function updatePlaceholderVisibility(){
      const hasText = normalizeSpaces(wordInput.value).length > 0;
      const isFocused = document.activeElement === wordInput;
      pseudoPlaceholder.classList.toggle('hidden', hasText || isFocused);
    }

    function showToast(message, type='ok'){
      // type: ok | warn | bad | info
      const existing = document.querySelector('.toast');
      if (existing) existing.remove();

      const toast = document.createElement('div');
      toast.className = 'toast';

      let bg = 'linear-gradient(135deg, #2ecc71, #27ae60)';
      let icon = '<i class="fas fa-check-circle"></i>';

      if (type === 'warn'){
        bg = 'linear-gradient(135deg, #f39c12, #e67e22)';
        icon = '<i class="fas fa-exclamation-triangle"></i>';
      } else if (type === 'bad'){
        bg = 'linear-gradient(135deg, #e74c3c, #c0392b)';
        icon = '<i class="fas fa-times-circle"></i>';
      } else if (type === 'info'){
        bg = 'linear-gradient(135deg, #3498db, #2980b9)';
        icon = '<i class="fas fa-info-circle"></i>';
      }

      toast.style.background = bg;
      toast.innerHTML = `
        <div style="font-size:1.2rem; line-height:1;">${icon}</div>
        <div style="font-weight:1000;">
          <div>${message}</div>
        </div>
      `;

      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'toastOut .22s ease-out forwards';
        setTimeout(() => toast.remove(), 220);
      }, 2200);
    }

    async function copyToClipboard(text, okMsg='Panoya kopyalandı'){
      try{
        await navigator.clipboard.writeText(text);
        showToast(okMsg, 'ok');
      }catch(e){
        // fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        document.body.appendChild(ta);
        ta.select();
        try{
          document.execCommand('copy');
          showToast(okMsg, 'ok');
        }catch(err){
          showToast('Kopyalama başarısız. Tarayıcı izinlerini kontrol edin.', 'bad');
        }finally{
          document.body.removeChild(ta);
        }
      }
    }

    function dateStampTR(){
      const now = new Date();
      const dateStr = now.toLocaleDateString('tr-TR').replaceAll('/', '-');
      const timeStr = now.toLocaleTimeString('tr-TR').replaceAll(':', '.');
      return { dateStr, timeStr };
    }

    function buildNumberedList(list){
      if (!list || list.length === 0) return '(boş)\n';
      return list.map((w,i)=>`${i+1}. ${w}`).join('\n') + '\n';
    }
    function buildCommaLine(list){
      if (!list || list.length === 0) return '(boş)';
      return list.join(', ');
    }
    function buildDownloadContent({ headerTitle, metaLines = [], sections = [] }){
      const stamp = dateStampTR();
      let content = `${headerTitle}\n${'='.repeat(Math.min(70, headerTitle.length))}\n`;
      content += `Tarih: ${stamp.dateStr} ${stamp.timeStr}\n`;
      metaLines.forEach(l => content += `${l}\n`);
      content += '\n';

      sections.forEach(sec => {
        content += `=== ${sec.title} ===\n\n`;
        content += `Numaralı Liste:\n${buildNumberedList(sec.list)}\n`;
        content += `Virgüllü Tek Satır:\n${buildCommaLine(sec.list)}\n\n`;
      });

      return content;
    }
    function downloadFile(content, fileName, mimeType='text/plain'){
      const blob = new Blob([content], { type: mimeType });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 100);
      showToast('İndirme başlatıldı', 'info');
    }

    // =========================
    // MODE / FLOW
    // =========================
    function selectMode(mode){
      currentMode = mode;
      mode1Btn.classList.toggle('active', mode === 1);
      mode2Btn.classList.toggle('active', mode === 2);
    }

    function continueToInput(){
      setActivePhase(1);
      wordInput.focus();
      updatePlaceholderVisibility();
    }

    function startProcess(){
      const parsed = parseInputWords(wordInput.value);

      if (parsed.length === 0){
        showToast('Lütfen en az bir kelime girin.', 'warn');
        wordInput.focus();
        updatePlaceholderVisibility();
        return;
      }

      // Mod 1: sıralı çalışması için asla shuffle yok.
      allWords = parsed.map(w => cleanDisplayWord(w));
      originalWords = [...allWords];

      if (currentMode === 1) startElemeMode();
      else startUniqueMode();
    }

    // =========================
    // MOD 1: ELEME (SIRALI)
    // =========================
    function startElemeMode(){
      currentWordIndex = 0;
      correctWords = [];
      incorrectWords = [];
      setActivePhase(2);
      showCurrentWord();
    }

    function updateProgress(){
      const total = allWords.length || 1;
      const done = Math.min(currentWordIndex + 1, allWords.length);
      const progress = (done / total) * 100;
      progressFill.style.width = `${Math.min(100, Math.max(0, progress))}%`;
      progressText.textContent = `${done}/${allWords.length}`;
    }

    function showCurrentWord(){
      if (currentWordIndex < allWords.length){
        // Ekranda "1. Donald Duck" görünmesin; zaten parse sırasında temizlendi
        currentWordElement.textContent = allWords[currentWordIndex];
        currentWordElement.classList.add('word-animation');

        updateProgress();

        const remaining = allWords.length - currentWordIndex - 1;
        counter.textContent = `Kalan: ${remaining}`;

        setTimeout(() => currentWordElement.classList.remove('word-animation'), 240);
      } else {
        finishPractice();
      }
    }

    function handleAnswer(isCorrect){
      if (currentWordIndex >= allWords.length) return;

      const word = allWords[currentWordIndex];

      if (isCorrect){
        correctWords.push(word);
        bigCorrectBtn.style.transform = 'scale(.985)';
        setTimeout(()=>bigCorrectBtn.style.transform='', 120);
      } else {
        incorrectWords.push(word);
        bigIncorrectBtn.style.transform = 'scale(.985)';
        setTimeout(()=>bigIncorrectBtn.style.transform='', 120);
      }

      currentWordIndex++;
      setTimeout(showCurrentWord, 90);
    }

    function pausePractice(){
      if (currentWordIndex < allWords.length){
        if (confirm('Elemeyi durdurup sonuçları görmek istiyor musunuz?')){
          finishPractice();
        }
      } else {
        finishPractice();
      }
    }

    function finishPractice(){
      // Kalan kelimeleri otomatik "Tekrar Çalış"
      for (let i = currentWordIndex; i < allWords.length; i++){
        incorrectWords.push(allWords[i]);
      }

      setActivePhase(3);
      displayResults();
    }

    function displayResults(){
      const total = allWords.length;
      totalWordsCount.textContent = total;

      const correct = correctWords.length;
      const incorrect = incorrectWords.length;

      const pct = total > 0 ? Math.round((correct / total) * 100) : 0;
      correctPercentage.textContent = `${pct}%`;
      correctPercentageBar.style.width = `${pct}%`;

      correctList.innerHTML = '';
      correctWords.forEach(w => {
        const li = document.createElement('li');
        li.textContent = w;
        correctList.appendChild(li);
      });
      correctCount.textContent = correct;

      incorrectList.innerHTML = '';
      incorrectWords.forEach(w => {
        const li = document.createElement('li');
        li.textContent = w;
        incorrectList.appendChild(li);
      });
      incorrectCount.textContent = incorrect;

      const existing = phases[3].querySelector('.result-message');
      if (existing) existing.remove();

      let message = '';
      if (incorrect === 0 && total > 0) message = '<i class="fas fa-trophy"></i> Mükemmel! Tüm kelimeleri biliyorsunuz!';
      else if (pct >= 80) message = '<i class="fas fa-star"></i> Çok iyi! Harika bir sonuç!';
      else if (pct >= 60) message = '<i class="fas fa-thumbs-up"></i> İyi gidiyorsunuz, biraz daha çalışın!';
      else message = '<i class="fas fa-redo"></i> Daha çok pratik yapmanız gerekiyor. Tekrar deneyin!';

      const msg = document.createElement('p');
      msg.className = 'result-message';
      msg.style.background = 'linear-gradient(135deg, #ff6b6b, #4ecdc4)';
      msg.innerHTML = message;

      phases[3].insertBefore(msg, phases[3].querySelector('.info-card'));
    }

    function restartPractice(onlyWrong=false){
      let list = [];
      if (onlyWrong){
        if (incorrectWords.length === 0){
          showToast('Tekrar çalışılacak kelime yok.', 'warn');
          return;
        }
        list = [...incorrectWords];
      } else {
        list = [...originalWords];
      }

      allWords = [...list]; // sıralı kalsın; karıştırma yok
      currentWordIndex = 0;
      correctWords = [];
      incorrectWords = [];
      setActivePhase(2);
      showCurrentWord();
    }

    function newList(){
      wordInput.value = '';
      updatePlaceholderVisibility();
      setActivePhase(1);
      wordInput.focus();
    }

    // =========================
    // MOD 2: AYNILARI BUL (TR CASE + TITLECASE)
    // =========================
    function startUniqueMode(){
      wordCountMap.clear();
      uniqueWords = [];
      duplicateWordsCounted = [];
      duplicateBaseWords = [];

      // sayım: key -> count
      allWords.forEach(w => {
        const key = normalizeKey(w);
        wordCountMap.set(key, (wordCountMap.get(key) || 0) + 1);
      });

      // canonical: her key için Title Case üret
      const keys = Array.from(wordCountMap.keys());

      keys.forEach(key => {
        const canonical = toTitleCaseTR(key); // key zaten lower(tr), titlecase'e dönüyor
        uniqueWords.push(canonical);

        const count = wordCountMap.get(key);
        if (count > 1){
          duplicateBaseWords.push(canonical);
          duplicateWordsCounted.push(`${canonical} (${count} kez)`);
        }
      });

      // Sıralama: TR
      uniqueWords.sort((a,b)=>a.localeCompare(b,'tr'));
      duplicateBaseWords.sort((a,b)=>a.localeCompare(b,'tr'));
      duplicateWordsCounted.sort((a,b)=>a.localeCompare(b,'tr'));

      setActivePhase(4);
      displayUniqueResults();
    }

    function displayUniqueResults(){
      const original = allWords.length;
      const uniq = uniqueWords.length;
      const removed = original - uniq;

      originalCount.textContent = original;
      uniqueCount.textContent = uniq;
      duplicateCount.textContent = removed;
      uniqueWordsCount.textContent = uniq;

      uniqueList.innerHTML = '';
      uniqueWords.forEach(w => {
        const li = document.createElement('li');
        li.textContent = w;
        uniqueList.appendChild(li);
      });

      const existing = phases[4].querySelector('.result-message');
      if (existing) existing.remove();

      const msgText = removed === 0
        ? '<i class="fas fa-check-circle"></i> Listenizde hiç tekrar eden kelime yok!'
        : `<i class="fas fa-filter"></i> ${removed} adet tekrar eden kelime çıkarıldı.`;

      const msg = document.createElement('p');
      msg.className = 'result-message';
      msg.style.background = 'linear-gradient(135deg, #3498db, #2980b9)';
      msg.innerHTML = msgText;

      phases[4].insertBefore(msg, phases[4].querySelector('.info-card'));
    }

    function newListForUnique(){
      wordInput.value = '';
      updatePlaceholderVisibility();
      setActivePhase(1);
      wordInput.focus();
    }

    // =========================
    // COPY ACTIONS
    // =========================
    function listToComma(list){ return buildCommaLine(list); }
    function listToNumbered(list){ return list.map((w,i)=>`${i+1}. ${w}`).join('\n'); }

    // =========================
    // DOWNLOAD ACTIONS (TitleCase only for Mode2 lists already)
    // =========================
    function downloadAllResults(){
      if (correctWords.length === 0 && incorrectWords.length === 0){
        showToast('İndirilecek sonuç yok.', 'warn');
        return;
      }
      const total = allWords.length;
      const pct = total > 0 ? Math.round((correctWords.length / total) * 100) : 0;

      const content = buildDownloadContent({
        headerTitle: 'Tabu Kelime Eleme Sonuçları (Tüm Liste)',
        metaLines: [
          `Toplam Kelime: ${total}`,
          `Bilinenler: ${correctWords.length}`,
          `Tekrar Çalışılacaklar: ${incorrectWords.length}`,
          `Başarı Oranı: ${pct}%`
        ],
        sections: [
          { title: 'BİLİNEN KELİMELER', list: correctWords },
          { title: 'TEKRAR ÇALIŞILACAK KELİMELER', list: incorrectWords }
        ]
      });

      const s = dateStampTR();
      downloadFile(content, `tabu-sonuclari-tum-${s.dateStr}-${s.timeStr}.txt`);
    }

    function downloadWrongResults(){
      if (incorrectWords.length === 0){
        showToast('Tekrar çalışılacak kelime yok.', 'warn');
        return;
      }
      const content = buildDownloadContent({
        headerTitle: 'Tabu Kelime Eleme (Tekrar Çalışılacaklar)',
        metaLines: [
          `Toplam: ${incorrectWords.length} kelime`
        ],
        sections: [
          { title: 'TEKRAR ÇALIŞILACAK KELİMELER', list: incorrectWords }
        ]
      });

      const s = dateStampTR();
      downloadFile(content, `tabu-tekrar-calisilacaklar-${s.dateStr}-${s.timeStr}.txt`);
    }

    function downloadUniqueResults(){
      if (uniqueWords.length === 0){
        showToast('Benzersiz liste yok.', 'warn');
        return;
      }
      const removed = allWords.length - uniqueWords.length;

      const content = buildDownloadContent({
        headerTitle: 'Tabu Benzersiz Kelime Listesi',
        metaLines: [
          `Orijinal: ${allWords.length}`,
          `Benzersiz: ${uniqueWords.length}`,
          `Çıkarılan tekrar: ${removed}`
        ],
        sections: [
          { title: 'BENZERSİZ KELİMELER (Title Case)', list: uniqueWords }
        ]
      });

      const s = dateStampTR();
      downloadFile(content, `tabu-benzersiz-${s.dateStr}-${s.timeStr}.txt`);
    }

    function downloadDuplicateResults(){
      if (duplicateWordsCounted.length === 0){
        showToast('Tekrar eden kelime yok.', 'warn');
        return;
      }

      const content = buildDownloadContent({
        headerTitle: 'Tabu Tekrar Eden Kelimeler',
        metaLines: [
          `Tekrar eden tür sayısı: ${duplicateWordsCounted.length}`
        ],
        sections: [
          { title: 'TEKRAR EDENLER (SAYILI)', list: duplicateWordsCounted },
          { title: 'TEKRAR EDENLER (SADECE KELİME)', list: duplicateBaseWords }
        ]
      });

      const s = dateStampTR();
      downloadFile(content, `tabu-tekrar-edenler-${s.dateStr}-${s.timeStr}.txt`);
    }

    // =========================
    // KEYBOARD + SWIPE (Mod1 Phase2)
    // =========================
    function handleKeyDown(e){
      if (!phases[2].classList.contains('active')) return;

      switch (e.key){
        case 'ArrowRight':
        case 'd': case 'D':
        case '1':
          handleAnswer(true);
          e.preventDefault();
          break;

        case 'ArrowLeft':
        case 'y': case 'Y':
        case '2':
          handleAnswer(false);
          e.preventDefault();
          break;

        case ' ':
        case 'Enter':
          pausePractice();
          e.preventDefault();
          break;

        case 'Escape':
          if (confirm('Elemeyi durdurmak istiyor musunuz?')) finishPractice();
          e.preventDefault();
          break;
      }
    }

    function setupTouchEvents(){
      let sx=0, sy=0;

      document.addEventListener('touchstart', (e)=>{
        if (!e.touches || !e.touches[0]) return;
        sx = e.touches[0].clientX;
        sy = e.touches[0].clientY;
      }, { passive:true });

      document.addEventListener('touchend', (e)=>{
        if (!phases[2].classList.contains('active')) return;
        if (!e.changedTouches || !e.changedTouches[0]) return;

        const ex = e.changedTouches[0].clientX;
        const ey = e.changedTouches[0].clientY;

        const dx = ex - sx;
        const dy = ey - sy;

        if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 50){
          if (dx > 0) handleAnswer(true);
          else handleAnswer(false);
        }
      }, { passive:true });
    }

    // =========================
    // INIT
    // =========================
    function init(){
      continueBtn.addEventListener('click', continueToInput);

      mode1Btn.addEventListener('click', ()=>selectMode(1));
      mode2Btn.addEventListener('click', ()=>selectMode(2));
      mode1Btn.addEventListener('keydown', (e)=>{ if (e.key==='Enter') selectMode(1); });
      mode2Btn.addEventListener('keydown', (e)=>{ if (e.key==='Enter') selectMode(2); });

      backToModeBtn.addEventListener('click', ()=>setActivePhase(0));
      backToModeFromElemeBtn.addEventListener('click', ()=>setActivePhase(0));
      backToModeFromResultsBtn.addEventListener('click', ()=>setActivePhase(0));

      startBtn.addEventListener('click', startProcess);

      bigCorrectBtn.addEventListener('click', ()=>handleAnswer(true));
      bigIncorrectBtn.addEventListener('click', ()=>handleAnswer(false));
      pauseBtn.addEventListener('click', pausePractice);

      restartBtn.addEventListener('click', ()=>restartPractice(false));
      practiceWrongBtn.addEventListener('click', ()=>restartPractice(true));
      newListBtn.addEventListener('click', newList);

      restartUniqueBtn.addEventListener('click', newListForUnique);

      downloadAllBtn.addEventListener('click', downloadAllResults);
      downloadWrongBtn.addEventListener('click', downloadWrongResults);
      downloadUniqueBtn.addEventListener('click', downloadUniqueResults);
      downloadDuplicatesBtn.addEventListener('click', downloadDuplicateResults);

      copyKnownCommaBtn.addEventListener('click', ()=>copyToClipboard(listToComma(correctWords), 'Bildikleriniz (virgüllü) kopyalandı'));
      copyWrongCommaBtn.addEventListener('click', ()=>copyToClipboard(listToComma(incorrectWords), 'Tekrar çalışılacaklar (virgüllü) kopyalandı'));
      copyKnownNumberedBtn.addEventListener('click', ()=>copyToClipboard(listToNumbered(correctWords), 'Bildikleriniz (numaralı) kopyalandı'));
      copyWrongNumberedBtn.addEventListener('click', ()=>copyToClipboard(listToNumbered(incorrectWords), 'Tekrar çalışılacaklar (numaralı) kopyalandı'));

      copyUniqueCommaBtn.addEventListener('click', ()=>copyToClipboard(listToComma(uniqueWords), 'Benzersiz (virgüllü) kopyalandı'));
      copyDupCommaBtn.addEventListener('click', ()=>copyToClipboard(listToComma(duplicateBaseWords), 'Tekrar edenler (virgüllü) kopyalandı'));
      copyUniqueNumberedBtn.addEventListener('click', ()=>copyToClipboard(listToNumbered(uniqueWords), 'Benzersiz (numaralı) kopyalandı'));
      copyDupNumberedBtn.addEventListener('click', ()=>copyToClipboard(listToNumbered(duplicateBaseWords), 'Tekrar edenler (numaralı) kopyalandı'));

      document.addEventListener('keydown', handleKeyDown);
      setupTouchEvents();

      // Saydam iç yazı davranışı:
      // - tıklayınca kaybolsun
      // - boşsa blur olunca geri gelsin
      wordInput.addEventListener('focus', updatePlaceholderVisibility);
      wordInput.addEventListener('blur', updatePlaceholderVisibility);
      wordInput.addEventListener('input', updatePlaceholderVisibility);

      updatePlaceholderVisibility();
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
